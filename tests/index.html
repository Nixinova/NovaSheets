<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>NovaSheets Tests</title>
    <link rel="icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.10.1.css">
    <script src="https://code.jquery.com/qunit/qunit-2.10.1.js"></script>
    <script src="/src/novasheets.js"></script>
</head>

<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script>
        const ditto = null;
        function test(assert, content) {
            for (let item of content) {
                if (!item[1]) item[1] = item[0];
                assert.equal(parseNovaSheets(item[0]), item[1], item[0] + ' -> ' + item[1]);
            }
        }
        QUnit.module('NSS content', () => {
            QUnit.test('Variables', nss => {
                const vars = `
                    @var var1 // void
                    @var var2 = $[1] content // void
                    @var var3 // void
                        $[type] content // void
                    @endvar // void
                `;
                const tests = [
                    [vars + '$(var1)', ' '],
                    [vars + '$(var2|inline)', 'inline content'],
                    [vars + '$(var3|type = block)', 'block content'],
                ];
                test(nss, tests);
            });
            QUnit.test('Parser constants', nss => {
                const tests = [
                    ['@const DECIMAL_PLACES 2\n2/3', '0.67'],
                    ['@const DECIMAL_PLACES 0\n2/3', '1'],
                ];
                test(nss, tests);
            });
        });
        QUnit.module('Misc', () => {
            QUnit.test('Watchlist', nss => {
                const tests = [
                    ['https://example.com', ditto],
                    ['::root {color: red;}', ditto],
                ];
                test(nss, tests);
            });
        });
        QUnit.module('Math', () => {
            QUnit.test('Basic math', nss => {
                const tests = [
                    ['1+2', '3'],
                    ['1 +2', '3'],
                    ['1 + 2', '3'],
                    ['1--2', '3'],
                    ['1-2', '-1'],
                    ['1- 2', '-1'],
                    ['1 - 2', '-1'],
                    ['1 -2', '-1'],
                    ['1-2-3-4-5-6-7-8-9-10', '-53'],
                    ['1/2', '0.5'],
                    ['1*2', '2'],
                    ['1^2', '1'],
                    ['1**2', '1'],
                    ['1e2', '100'],
                    ['(1+2)', '3'],
                    ['(1+3)/2', '2'],
                    ['(1 -- 2) /3', '1'],
                    ['(1 + 3**2) - (2 / 2**4 + 1 / 4)', '9.625'],
                    ['1em -2em', ditto],
                    ['1em 2em', ditto],
                    ['(1+3)em/2', '2em'],
                    ['(1+3)em/2em', '2em'],
                    ['(1+3)/2em', '2em'],
                    ['1ms + 2ms', '3ms'],
                    ['1s + 1000ms', '2s'],
                    ['1s + 50ms', '1.05s'],
                    ['1cm + 20mm', '3cm'],
                ];
                test(nss, tests);
            });
        });
        QUnit.module('Built-in functions', () => {
            QUnit.test('Math functions', nss => {
                const tests = [
                    ['$(@round | 1.2 )', '1'],
                    ['$(@ceil | 0.7 )', '1'],
                    ['$(@floor | 1.7 )', '1'],
                    ['$(@round | $(@e) | 5 )', '2.71828'],
                    ['$(@round | $(@pi) | 5 )', '3.14159'],
                    ['$(@abs | -5 )', '5'],
                    ['$(@sin | $(@pi)/2 )', '1'],
                    ['$(@cos | $(@pi) )', '-1'],
                    ['$(@round | $(@acos | 0) | 5 )', '1.5708'],
                    ['$(@clamp | -5 | 1 | 5 )', '1'],
                    ['$(@clamp | 10 | 1 | 5 )', '5'],
                    ['$(@min | -5 | 1 | 6 )', '-5'],
                    ['$(@max | -5 | 1 | 6 )', '6'],
                    ['$(@degrees | 2*$(@pi) )', '360'],
                    ['$(@degrees | 2*$(@pi) )', '360'],
                    ['$(@radians | 90deg )/$(@pi)', '0.5'],
                    ['$(@gradians | $(@pi)rad )', '200'],
                    ['$(@gradians | 180 )', '200'],
                    ['$(@log | 10 | 10000 )', '4'],
                    ['$(@log | 2 | 64 )', '6'],
                    ['$(@root | 2 | 64 )', '8'],
                    ['$(@root | 2 | 25 )', '5'],
                    ['$(@mod | 10 | 6 )', '4'],
                    ['$(@percent | 0.5 )', '50%'],
                ];
                test(nss, tests);
            });
            QUnit.test('Logic functions', nss => {
                const tests = [
                    ['$(@bitwise | ~2 & 4)', '4'],
                    ['$(@boolean | true and false or true)', 'true'],
                    ['$(@if | 1 < 2 | iftrue | iffalse)', 'iftrue'],
                ];
                test(nss, tests);
            });
            QUnit.test('Text functions', nss => {
                const tests = [
                    ['$(@lowercase | Lowercase Text )', 'lowercase text'],
                    ['$(@uppercase | UpperCase Text )', 'UPPERCASE TEXT'],
                    ['$(@titlecase | title case TEXT )', 'Title Case TEXT'],
                    ['$(@camelcase | title case TEXT )', 'title Case TEXT'],
                    ['$(@capitalize | capitaliZed )', 'CapitaliZed'],
                    ['$(@length | 123456 )', '6'],
                    ['$(@encode | [text]="true")', '%5Btext%5D%3D%22true%22'],
                    ['$(@replace | text | /te(.)t/ | !$1! )', '!x!'],
                ];
                test(nss, tests)
            });
            QUnit.test('Colour functions', nss => {
                const tests = [
                    ['$(@color | hash | rgb(128, 255, 0) )', '#80ff00'],
                    ['$(@colourpart | red | #fff)', '255'],
                    ['$(@luma | rgb(10, 20%, 100%) )', '0.09652182741852182'],
                    ['$(@spin | hsl(10, 20%, 30) | -10 )', 'hsl(0, 20%, 30)'],
                    ['$(@shade | #fff | 50% )', '#7f7f7f'],
                    ['$(@tint | rgb(10, 75%, 20) | 10% )', 'rgb(34, 198, 43)'],
                    ['$(@tone | hsl(100, 75%, 20%) | 50% )', 'hsl(100, 25%, 20%)'],
                    ['$(@contrast | #1e5 | white | black )', 'white'],
                ];
                test(nss, tests);
            });
            QUnit.test('Loop functions', nss => {
                const tests = [
                    ['$(@each | a,b,c | , |; | $v: $(@cos|$(@pi)*$i) )', 'a: -1; b: 1; c: -1'],
                    ['$(@repeat | 3 | ;(10x$i)exp2=$(@root | 0.5 | 10*$i ) );', ';(10x1)exp2=100;(10x2)exp2=400;(10x3)exp2=900;'],
                    ['$(@each | 1,2,3,4,5,6,7,8,9 | , | | $v($i) )', '1(1) 2(2) 3(3) 4(4) 5(5) 6(6) 7(7) 8(8) 9(9)'],
                ];
                test(nss, tests);
            });
            QUnit.test('CSS functions', nss => {
                const tests = [
                    ['$(@breakpoint | 500px | selector | less | more )', ' @media (max-width: 500px) { selector { less } } @media (min-width: 501px) { selector { more } }'],
                    ['$(@breakpoint | 500px | less {} | more {} )', ' @media (max-width: 500px) { less {} } @media (min-width: 501px) { more {} }'],
                    ['$(@prefix | transition | all 1s )', '-webkit-transition: all 1s; -moz-transition: all 1s; -ms-transition: all 1s; -o-transition: all 1s; transition: all 1s;']
                ];
                test(nss, tests);
            });
        });
        QUnit.module('CSS aspects', () => {
            QUnit.test('Comments', nss => {
                const tests = [
                    [' // inline comment', ' '],
                    ['/*regular block comment, $(@e)*/', ditto],
                    ['/*/static comment, $(@e)/*/', 'static comment, $(@e)'],
                    ['/*[parsed comment, $(@e)]*/', '/*parsed comment, 2.718281828459045*/'],
                ];
                test(nss, tests);
            });
            QUnit.test('Prev selectors', nss => {
                const tests = [
                    ['.list {} & .item {}', '.list {} .list .item {}'],
                    ['.list p {} &< .item {}', '.list p {} .list .item {}'],
                ];
                test(nss, tests);
            });
        });
    </script>
</body>

</html>