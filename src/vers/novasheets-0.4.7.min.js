function nse(e,t){return t?"func"==e?nse(`Unknown argument "${t[1]}" in function "${t[0]}" ${t[2]}`.trim()+"."):void 0:console.error("<NovaSheets> Parsing failed: "+e)}function parseNovaSheets(){let esh,ish;try{esh=document.querySelectorAll('link[rel="novasheet" i], link[rel="novasheets" i]'),ish=document.querySelectorAll('[type="novasheet" i], [type="novasheets" i]')}catch(e){esh=document.querySelectorAll('link[rel="novasheet"], link[rel="novasheets"]'),ish=document.querySelectorAll('[type="novasheet"], [type="novasheets"]')}let fn={full:[],rel:[]},src=[];for(let e of esh)fn.full.push(e.href),fn.rel.push(e.getAttribute("href"));let sc=[];for(let e in fn.full)try{let t=new XMLHttpRequest;t.open("GET",fn.full[e],!1),t.send();let r=t.responseText;sc.push(r.toString()),src.push(fn.rel[e])}catch(t){nse(`File "${fn.rel[e]}" cannot be accessed.`)}for(let e of ish)sc.push(e.innerHTML),src.push("inline");window.randomHash=window.randomHash||Math.random().toString().hash(6);for(let s in sc){sc[s]=sc[s].replace(/^(.*?)\/\/.*$/gm,"$1").replace(/^@var.+?=.*$/gm,"$& @endvar").replace(/@(var|const|endvar)/g,"\n$&").replace(/@const\s*[A-Z_]+\s*(true|false|[0-9]+)|@endvar/g,"$&\n");let ln=sc[s].split("\n"),cso="";for(let e in ln)ln[e]=ln[e].replace(/[\r\n]/g," ").trim(),cso+=" "+ln[e];cso=cso.replace(/\s*@var[\s\S]*?((?=\s*@var)|@endvar)|@const\s*[A-Z_]+\s*(true|false|[0-9]+)/gm," ");let cv=[],lv=[],pc1=50,pc2=5,pc3=10,pc4=!1;for(let e in ln)if(ln[e].match(/^\s*@var\s/)){let t=ln[e].replace(/^\s*@var\s/,"").split("="),r=ln.slice(e),s;for(let e in r)if(r[e].match(/^\s*@endvar\s*$|^\s*@var\s/)&&0!=e){s=e;break}let n=t[0].trim(),a=(t[1]||"")+r.slice(1,s).join(" ");cv.push({line:Number(e),ending:Number(s),cn:a.trim(),na:n.split("|")[0].trim(),pr:n.split("|").slice(1)})}else ln[e].match(/^\s*@const\s*MAX_RECURSION\s/)?pc1=Number(ln[e].split("MAX_RECURSION")[1]):ln[e].match(/^\s*@const\s*MAX_MATH_RECURSION\s/)?pc2=Number(ln[e].split("MAX_MATH_RECURSION")[1]):ln[e].match(/^\s*@const\s*MAX_ARGUMENTS\s/)?pc3=Number(ln[e].split("MAX_ARGUMENTS")[1]):ln[e].match(/^\s*@const\s*KEEP_NAN\s/)&&(pc4=!["0","false"].includes(ln[e].split("KEEP_NAN")[1].trim()));for(let e in cv)for(let t in cv[e].pr){let r=cv[e].pr[t].trim(),s=[t,cv[e].na,window.randomHash,r].join("~"),n=`$[${r}]`,a=`$(${s})`;cv[e].cn=cv[e].cn.split(n).join(a),lv.push(s)}let loop=0;for(;(cso.indexOf("$(")>-1||loop<2)&&loop++<pc1;){for(let e in cv){let t=cv[e].na.er(),r=e=>"\\s*(?:\\|\\s*([^"+(e||"")+"|$()]+)\\s*)?",s=r().repeat(pc3),n=`\\$\\(\\s*(${t})\\s*${s}\\s*\\)`,a=`\\$\\(\\s*${t}${r("=").repeat(pc3)}\\s*\\)`,u="$("+t;for(let e=1;e<=pc3;e++)u+="|"+e+"=$"+e;cso=cso.replace(RegExp(a),u+")");let l=cso.match(RegExp(n));if(!l)continue;let c="\\$\\(\\s*"+t+"[^$()]*?\\)";cso=cso.replace(RegExp(c),cv[e].cn);for(let e=0;e<l.length;e++){if(e<2||!l[e])continue;let[t,r]=l[e].split("=");for(let e of lv){let s="\\$\\(\\s*"+e.er()+"\\)",n=e.split("~").splice(3).join("~");n===t.trim()&&(cso=cso.replace(RegExp(s,"g"),r.trim()))}}}const nsf=(e,t="[^|)]*?",r)=>(Array.isArray(t)||(t=Array(r||pc3).fill(t)),RegExp(`\\$\\(\\s*${e}\\s*(?:\\|\\s*(${t.join("))?\\s*(?:\\|\\s*(")}))?\\s*\\)`,"g")),nm="-?[0-9]*\\.?[0-9]+",bn="-?(?:0x[0-9a-f]*.?[0-9a-f]+|0b[01]*.?[01]+|0o[0-7]*.?[0-7]+|"+nm+")",bnr=`\\((?:${bn})\\)|${bn}`,nur=`(${bnr})(?:\\s*(cm|mm|m|ft|in|em|rem|en|ex|px|pt|pc))`,ton=e=>pc4?Number(e):isNaN(Number(e))?"":Number(e),mr=e=>`(?<!@replace[^)]*)(${bnr})\\s*${e.er()}\\s*(${bnr})`,mrb=e=>"\\(\\s*"+mr(e)+"\\s*\\)",umr=e=>`${nur}?\\s*${e.er()}\\s*${nur}?`,pm=(ops,b)=>{for(let op of ops)for(let i=0;i<pc2;i++){Array.isArray(op)||(op=[op,op]),cso=cso.replace(RegExp("(?<!(?:#|0x)[0-9a-f.]*)"+bn,"g"),e=>ton(e)).replace(RegExp(`(${nm})[Ee]([+-]?${nm})`),(e,t,r)=>{return(ton(t)*Math.pow(10,ton(r))).toFixed(20).replace(/\.?0+$/,"")}).replace(/(?:\+\s*|-\s*-\s*)+([.0-9]+)/,"+$1").replace(/(?:\+\s*-|-\s*\+)+(?:\+\s*)*\s*([.0-9]+)/,"-$1").replace(RegExp(umr(op[0])),(_,n1,u1,n2,u2)=>{if(!u2&&!u2)return _;n1=ton(n1.replace(/[()]/g,"")),n2=ton(n2.replace(/[()]/g,""));let ot=(n1,n2)=>eval(n1+op[0]+n2);if(!u1&&!u2)return _;switch(u1+","+u2){case"m,cm":return ot(100*n1,n2)+u2;case"cm,m":return ot(n1/100,n2)+u2;case"m,mm":return ot(1e3*n1,n2)+u2;case"mm,m":return ot(n1/1e3,n2)+u2;case"cm,mm":return ot(10*n1,n2)+u2;case"mm,cm":return ot(n1/10,n2)+u2;case"m,in":return ot(39.3701*n1,n2)+u2;case"in,m":return ot(n1/39.3701,n2)+u2;case"cm,in":return ot(.393701*n1,n2)+u2;case"in,cm":return ot(n1/.393701,n2)+u2;case"mm,in":return ot(.0393701*n1,n2)+u2;case"in,mm":return ot(n1/.393701,n2)+u2;case"m,ft":return ot(3.28084*n1,n2)+u2;case"ft,m":return ot(n1/3.28084,n2)+u2;case"cm,ft":return ot(.0328084*n1,n2)+u2;case"ft,cm":return ot(n1/.0328084,n2)+u2;case"mm,ft":return ot(.00328084*n1,n2)+u2;case"ft,mm":return ot(n1/.00328084,n2)+u2;default:return ot(n1,n2)+(u2||u1)}}).replace(RegExp(nur),e=>e.replace(/[()]\s*/g,""));let regex=b?mrb(op[0]):mr(op[0]),nums=cso.match(RegExp(regex));if(!nums)continue;let n1=ton(nums[1].replace(/[()]/g,"")),n2=Number(nums[2].replace(/[()]/g,"")),result=eval(n1+op[1]+n2);cso=cso.replace(RegExp(regex),result)}},opz=["**",["^","**"],"/","*","+","-",["--","- -"]];pm(opz,!0),pm(opz,!1),cso=cso.replace(/\$\(@pi\)/g,Math.PI).replace(/\$\(@e\)/g,Math.E).replace(nsf("@mod",nm,2),(e,t,r)=>t%r).replace(nsf("@sin",nm,1),(e,t)=>Math.sin(t)).replace(nsf("@asin",nm,1),(e,t)=>Math.asin(t)).replace(nsf("@cos",nm,1),(e,t)=>Math.cos(t)).replace(nsf("@acos",nm,1),(e,t)=>Math.acos(t)).replace(nsf("@tan",nm,1),(e,t)=>Math.tan(t)).replace(nsf("@atan",nm,1),(e,t)=>Math.atan(t)).replace(nsf("@abs",nm,1),(e,t)=>Math.abs(t)).replace(nsf("@floor",nm,1),(e,t)=>Math.floor(t)).replace(nsf("@ceil",nm,1),(e,t)=>Math.ceil(t)).replace(nsf("@percent",nm,1),(e,t)=>100*ton(t)+"%").replace(nsf("@log",nm,2),(e,t,r)=>Math.log(r)/(t?Math.log(t):1)).replace(nsf("@root",nm,2),(e,t,r)=>Math.pow(r,1/t)).replace(nsf("@round",nm,2),(e,t,r)=>Math.round((ton(t)+Number.EPSILON)*Math.pow(10,r||0))/Math.pow(10,r||0)).replace(nsf("@(?:max|min)",nm),(e,...t)=>{let r=[];for(let e of t.slice(0,-2))e&&r.push(e);return e.includes("@min")?Math.min(...r):Math.max(...r)}).replace(nsf("@clamp",nm,3),(e,t,r,s)=>(s<r&&([r,s]=[s.trim(),r.trim()]),t<=r?r:t>=s?s:t)).replace(nsf("@degrees","("+nm+")\\s*(deg|rad|grad)?",1),(e,t,r,s)=>"grad"===s?10*r/9:r/Math.PI*180).replace(nsf("@radians","("+nm+")\\s*(deg|rad|grad)?",1),(e,t,r,s)=>"grad"===s?r*Math.PI/200:r*Math.PI/180).replace(nsf("@gradians","("+nm+")\\s*(deg|rad|grad)?",1),(e,t,r,s)=>"rad"===s?r/Math.PI*200:.9*r),cso=cso.replace(nsf("@encode"),(e,t)=>encodeURIComponent(t)).replace(nsf("@length"),(e,t)=>t.trim().length).replace(nsf("@replace"),(e,t,r,s)=>{let n=r.startsWith("/");if(n){let e=r.replace(/\/(.+?)\/([gimusy]*)/,"$1").trim(),t=r.replace(/\/(.+?)\/([gimusy]*)/,"$2").trim()||"s";r=RegExp(e,t)}return t.trim().replace(n?r:RegExp((r||" ").er(),"g"),s.trim())});const car=`(?:rgba?|hsla?)\\(\\s*\\d{1,3}\\s*,${`\\s*,\\s*${nm}%?\\s*`.repeat(3)}(?:\\s*,\\s*${nm})?\\s*\\)|#[0-9a-f]{3,8}`;cso=cso.replace(nsf("@color",["\\w+",...(nm+"%?|").repeat(4).split("|")],4),(e,t,r="",s="",n="",a="")=>{if("hash"===t||t.startsWith("hex")||"#"===t){if(!r)return"#000";r.startsWith("rgb")&&([r,s,n,a]=r.replace(/rgba?\(|\)/g,"").split(","));const e=e=>{let t=ton(e);return e.includes("%")&&(t=Math.ceil(ton(e.replace(/%/,""))/100*255)),t.toString(16).padStart(2,"0")};return"#"+e(r)+e(s)+e(n)+(e(a)<1?"":e(a))}if(t.includes("rgb")||t.includes("hsl")){const e=e=>{let a=ton(e.replace(/%/,"")),u=e.includes("%")?"%":"";return t.includes("rgb")&&((r+s+n).includes("%")||r<=1||s<=1||n<=1)&&!u&&(a=Math.ceil(a/255*100),u="%"),t.includes("hsl")&&e==r&&u&&(a=Math.ceil(a/100*360),u=""),a+u};return`${t}(${e(r)}, ${e(s)}, ${e(n)}${3===t.length?"":", "+e(a||"1")})`}return`${t.toLowerCase()}(${r} ${s} ${n}${a?" / "+a:""})`}).replace(nsf("@color",["\\w+",car]),(e,t,r)=>{if(r.startsWith("#")){let e;r.length-1==3?e=[r[1].repeat(2),r[2].repeat(2),r[3].repeat(2)]:r.length-1==4?e=[r[1].repeat(2),r[2].repeat(2),r[3].repeat(2),r[4].repeat(2)]:[5,6].includes(r.length-1)?e=[r[1]+r[2],r[3]+r[4],r[5]+(r[6]||"0")]:[7,8].includes(r.length-1)&&(e=[r[1]+r[2],r[3]+r[4],r[5]+r[6],r[7]+(r[8]||"0")]),r=parseInt(e[0],16),b=parseInt(e[1],16).toString()||0,c=parseInt(e[2],16).toString()||0,d=parseInt(e[3],16)||0}else parts=r.replace(/^\s*...a?\s*/,"").replace(/[()]/g,"").split(","),[r,b,c,d]=parts;return`${t}(${r}, ${b}, ${c}${d?", "+d:""})`}).replace(nsf("@colorpart",["\\w+",car]),(e,t,r)=>{t=t.trim().toLowerCase();let s=[];const n=(e,t)=>ton("0x"+e.substr(t,2)).toString();if((r=r.trim().toLowerCase()).startsWith("#")){let e=r.replace("#","");3===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+"00"),4===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+e[3].repeat(2)),6===e.length&&(e+="00"),s=[n(e,0),n(e,2),n(e,4),n(e,6)]}else s=r.replace(/^\s*...a?\s*/,"").replace(/[()]/g,"").split(",");return r.startsWith("#")||r.startsWith("rgb")?t.startsWith("r")?s[0]:t.startsWith("g")?s[1]:t.startsWith("b")?s[2]:t.startsWith("a")?s[3]:(nse("func",["colorpart",t,"of color type rgb/rgba/#"]),r):r.startsWith("hsl")?t.startsWith("h")?s[0]:t.startsWith("s")?s[1]:t.startsWith("l")?s[2]:t.startsWith("a")?s[3]:(nse("func",["colorpart",t,"of color type hsl/hsla"]),r):(nse("func",["colorpart",t,"of unknown color type"]),r)});const plg=arg=>{for(let e=0;e<pc3/10;e++)arg=arg.trim().replace(/(?:'(.+?)'|"(.+?)")+/,"$1$2").replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\bor\b/gi,"||").replace(/\band\b/gi,"&&").replace(/\bnot\b/gi,"!").replace(/(.+?)\bnor\b(.+)?/gi,"!($1) && !($2)").replace(/(.+?)\bnand\b(.+)?/gi,"!($1) || !($2)").replace(/(.+?)\bxor\b(.+)?/gi,"($1 && !($2)) || (!($1) && $2)").replace(/(.+?)\bxnor\b(.+)?/gi,"$1 == $2").replace(/(?!=)(!?)=(==)?(?!=)/g,"$1$2==");return arg.match(/(<|<=|>|>=|==|!=|&|\||!)/)&&(arg=eval(arg)),["false","undefined","null","NaN",""].includes(arg)&&(arg=!1),arg},lrg=e=>RegExp(`([+-]?${bnr})\\s*(?:${e})\\s*([+-]?${bnr})`);cso=cso.replace(nsf("@bitwise"),(_,a)=>{a=a.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<");for(let i=0;i<pc3/10;i++)a=a.replace(RegExp(`(?:~|!|not)\\s*([+-]?${bnr})`),(_,a)=>eval("~"+ton(a))).replace(lrg("or|\\|"),(_,a,b)=>eval(`(${ton(a)}) | (${ton(b)})`)).replace(lrg("nor"),(_,a,b)=>eval(`~ (${ton(a)}) | (${ton(b)})`)).replace(lrg("and|&"),(_,a,b)=>eval(`(${ton(a)}) & (${ton(b)})`)).replace(lrg("nand"),(_,a,b)=>eval(`~ (${ton(a)}) & (${ton(b)})`)).replace(lrg("xor"),(_,a,b)=>eval(`(${ton(a)}) ^ (${ton(b)})`)).replace(lrg("xnor"),(_,a,b)=>eval(`~ (${ton(a)}) ^ (${ton(b)})`));return a}).replace(nsf("@boolean"),(e,t)=>plg(t)).replace(nsf("@if"),(e,t,r,s)=>plg(t)?r:s||"")}if(cso=cso.replace(/\$\(.+?\)/g,"").replace(/@endvar/g,"").replace(/(\s*;)+/g,";").replace(/\s+/g," ").replace(/} *(?!$)/g,"}\n").replace(/\.?0{8,}\d/,"").replace(/(\d)(9{8,})\d?\b/g,(e,t)=>Number(t)+1),document.querySelectorAll(`[data-hash="${cso.hash()}"]`).length)break;let se=document.createElement("style");se.innerHTML="\n"+cso+"\n",se.dataset.hash=cso.hash(),se.dataset.source=src[s],(document.head||document.body).appendChild(se)}}String.prototype.hash=function(e){let t=0;for(let e=0;e<this.length;e++)t=(t<<5)-t+this.charCodeAt(e);return Math.abs(t).toString(16).substring(0,e||8).padStart(e,"0")},String.prototype.trim=function(e){return this.replace(/^\s*(.+?)\s*$/,"$1").replace(/\s+/g,e?"":" ")},String.prototype.er=function(){return this.replace(/[.*+?^/${}()|[\]\\]/g,"\\$&")},document.addEventListener("DOMContentLoaded",parseNovaSheets());