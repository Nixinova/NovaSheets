function parseNovaSheets(){let e=document.querySelectorAll('link[rel="novasheet"]'),t=[];for(let n of e)t.push(n.href);let n=[];for(let e of t)try{let t=new XMLHttpRequest;t.open("GET",e,!1),t.send();let r=t.responseText;n.push(r.toString())}catch(t){console.error(`NovaSheets parsing failed: File "${e}" cannot be accessed.`)}let r=document.querySelectorAll('template[type="novasheet"]');for(let e of r)n.push(e.innerHTML);for(let e of n){let t=e.split("\n"),n=[],r=[],o={};for(let e in t)if(t[e]=t[e].replace(/[\r\n]/g,"").replace(/^(.*?)\s?\/\/.+$/,"$1"),t[e].match(/\s*---\s*/)&&(t[e]="---"),t[e].match(/^\s*@var\s/)){let r=t[e].replace(/^\s*@var\s/,"");n.push({line:Number(e),contents:r,name:r.split("|")[0].trim(),subvars:r.split("|").splice(1)})}const l=t.indexOf("---"),s=t.slice(l+1).join("\n"),a=Math.random().toString().hashCode(6);for(let e in n){let s=n[e].line+1,i=n[e].name.trim(),p=n[e+1]&&n[e+1].line||l;for(o[i]="";s<p&&!t[s].match(/\s*@var\s/);)o[i]+=t[s].trim(),s++;for(let t of n[e].subvars){let l=[a,n[e].name,t.trim()].join("-"),s=`$[${t.trim()}]`,p=`$(${l})`;o[i]=o[i].split(s).join(p),r.push(l)}}let i=0,p=s;const c=50,h=10;for(;p.indexOf("$(")>-1&&i++<c;)for(let e in n){let t=`\\$\\((${n[e].name.escapeRegex()})\\s?${"(?:\\|([^|=)]+?[^|)]+))?".repeat(h)}\\)`,l=p.match(new RegExp(t)),s="\\$\\("+n[e].name+"[^)]*?\\)";if(p=p.replace(new RegExp(s),o[n[e].name]),l)for(let e=0;e<l.length;e++){if(e<2||!l[e])continue;let[t,n]=l[e].split("=");for(let e in r){let o=r[e].trim(),l="$(s*"+o+")";o.trim().split("-").splice(2).join("-")===t.trim()&&(p=p.replace(new RegExp(l.escapeRegex(),"g"),n))}}}p=p.replace(/; *;/g,";").replace(/ +/g," ");let f=document.createElement("style");f.dataset.hash=p.hashCode(),f.innerHTML="\n"+p+"\n",(document.head||document.body).appendChild(f)}}String.prototype.hashCode=function(e=8){let t=0;for(let e=0;e<this.length;e++)t=(t<<5)-t+this.charCodeAt(e);return Math.abs(t).toString(16).substring(0,e).padStart(e,"0")},String.prototype.trim=function(){return this.replace(/^ *(.+?) *$/,"$1")},String.prototype.escapeRegex=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},document.addEventListener("DOMContentLoaded",function(){parseNovaSheets()});