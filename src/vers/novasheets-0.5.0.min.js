function nsl(e,t){return"func"==e?nsl(`Unknown argument "${t[1]}" in function "${t[0]}" ${t[2]}`.trim()+"."):console.warn("<NovaSheets>",e)}function parseNovaSheets(){const r=String.raw;let exs,ins;try{exs=document.querySelectorAll('link[rel="novasheet" i], link[rel="novasheets" i]'),ins=document.querySelectorAll('[type="novasheet" i], [type="novasheets" i]')}catch(e){exs=document.querySelectorAll('link[rel="novasheet"], link[rel="novasheets"]'),ins=document.querySelectorAll('[type="novasheet"], [type="novasheets"]')}let fn={fls:[],rel:[]},src=[];for(let e of exs)fn.fls.push(e.href),fn.rel.push(e.getAttribute("href"));let stC=[];for(let e in fn.fls)try{let t=new XMLHttpRequest;t.open("GET",fn.fls[e],!1),t.send();let s=t.responseText;stC.push(s.toString()),src.push(fn.rel[e])}catch(e){}for(let e of ins)stC.push(e.innerHTML),src.push("inline");window.randomHash=window.randomHash||Math.random().toString().hash(6);for(let s in stC){stC[s]=stC[s].replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/^(.*?)\/\/.*$/gm,"$1").replace(/^@var.+?=.*$/gm,"$& @endvar").replace(/@(var|const|endvar)/g,"\n$&").replace(/@const\s*[A-Z_]+\s*(true|false|[0-9]+)|@endvar/g,"$&\n");let ln=stC[s].split("\n"),cso="",cmc=[],stc=[];for(let e in ln)ln[e]=ln[e].trim().replace(/[\r\n]/g," "),cso+=" "+ln[e];cso=cso.replace(/\s*@var[\s\S]*?((?=\s*@var)|@endvar)|@const\s*[A-Z_]+\s*(true|false|[0-9]+)/gm," ").replace(/\/\*(.+?)\*\//g,(e,t)=>e.startsWith("/*[")&&e.endsWith("]*/")?e.replace(/^\/\*\[(.+)\]\*\/$/,"/*$1*/"):e.startsWith("/*/")||e.endsWith("/*/")?e:(cmc.indexOf(t)<0&&cmc.push(t),"/*COMMENT#"+cmc.indexOf(t)+"*/")).replace(/\/\*\/(.+?)\/\*\//g,(e,t)=>(stc.indexOf(t)<0&&stc.push(t),"/*STATIC#"+stc.indexOf(t)+"*/"));let cv=[],pc1=50,pc2=5,pc3=10,pc4=!1;for(let e in ln)if(ln[e].match(/^\s*@var\s/)){let t=ln[e].replace(/^\s*@var\s/,"").split("="),s=ln.slice(e),r;for(let e in s)if(s[e].match(/^\s*@endvar\s*$|^\s*@var\s/)&&0!=e){r=e;break}let n=t[0].trim(),a=(t.slice(1).join("=")||"")+s.slice(1,r).join(" ");cv.push({cnt:a.trim(),name:n.split("|")[0].trim()})}else ln[e].match(/^\s*@const\s*MAX_RECURSION\s/)?pc1=parseInt(ln[e].split("MAX_RECURSION")[1]):ln[e].match(/^\s*@const\s*MAX_MATH_RECURSION\s/)?pc2=parseInt(ln[e].split("MAX_MATH_RECURSION")[1]):ln[e].match(/^\s*@const\s*MAX_ARGUMENTS\s/)?pc3=parseInt(ln[e].split("MAX_ARGUMENTS")[1]):ln[e].match(/^\s*@const\s*KEEP_NAN\s/)&&(pc4=!["0","false"].includes(ln[e].split("KEEP_NAN")[1].trim()));const nsf=(e,t,s)=>{let n=RegExp(r`\$\(\s*${e}\b`),a=cso.indexOf(cso.match(n)&&cso.match(n)[0]);if(a<0)return;let u,o=cso.substr(a),l=0,c="";for(let e=0;e<o.length&&(c+=o[e],l>0&&(u=!0),"("===o[e]&&l++,")"===o[e]&&l--,!u||0!==l);e++)if(e+1==o.length&&l>0)return;if(" "===c)return;let i=s?"|":/\s*\|\s*/,p=c.replace(/^\$\(\s*|\s*\)$/g,"").split(i);for(let e=0;e<pc3;e++)p[e]||(p[e]="");p[0]=c,(cso=cso.replace(c,t(...p))).match(n)&&nsf(e,t,s)};let lpi=0,lco;for(;(cso.indexOf("$(")>-1||lpi<2)&&lpi++<pc1&&lco!==cso;){lco=cso;for(let e in cv)nsf(cv[e].name,(t,...s)=>{let n=cv[e].cnt;for(let e in s){if(!s[e])break;[param,arg]=s[e].split("="),arg||([param,arg]=[+e+1,param]),n=n.replace(RegExp(r`\$\[${param}[^\]]*\]`,"g"),arg)}return n=n.replace(/\$\[.*?(?:\|([^\]]*))?\]/g,"$1")});const nm=r`-?[0-9]*\.?[0-9]+`,bnm=r`-?(?:0x[0-9a-f]*\.?[0-9a-f]+|0b[01]*\.?[01]+|0o[0-7]*\.?[0-7]+|${nm})`,bnr=r`\((?:${bnm})\)|${bnm}`,nur=r`(${bnr})(?:\s*(cm|mm|m|ft|in|em|rem|en|ex|px|pt|pc))`,ton=e=>pc4?Number(e):isNaN(Number(e))?"":Number(e),mr=e=>r`(${bnr})\s*${e.er()}\s*(${bnr})`,mrg=e=>r`\(\s*${mr(e)}\s*\)`,umr=e=>r`${nur}?\s*${e.er()}\s*${nur}?`,pm=(ops,b)=>{for(let op of ops)for(let i=0;i<pc2;i++){Array.isArray(op)||(op=[op,op]),cso=cso.replace(RegExp("(?<!#[0-9a-f.]*)"+bnm,"g"),e=>ton(e)).replace(RegExp(r`\b(${nm})[Ee]([+-]?${nm})\b`),(e,t,s)=>{return(ton(t)*Math.pow(10,ton(s))).toFixed(20).replace(/\.?0+$/,"")}).replace(/(?:\+\s*|-\s*-\s*)+([.0-9]+)/,"+$1").replace(/(?:\+\s*-|-\s*\+)+(?:\+\s*)*\s*([.0-9]+)/,"-$1").replace(RegExp(umr(op[0])),(_,n1,u1,n2,u2)=>{if(!u1&&!u2)return _;n1=ton(n1.replace(/[()]/g,"")),n2=ton(n2.replace(/[()]/g,""));let ot=(n1,n2)=>eval(n1+op[0]+n2);if(!u1&&!u2)return _;switch(u1+","+u2){case"m,cm":return ot(100*n1,n2)+u2;case"cm,m":return ot(n1/100,n2)+u2;case"m,mm":return ot(1e3*n1,n2)+u2;case"mm,m":return ot(n1/1e3,n2)+u2;case"cm,mm":return ot(10*n1,n2)+u2;case"mm,cm":return ot(n1/10,n2)+u2;case"m,in":return ot(39.3701*n1,n2)+u2;case"in,m":return ot(n1/39.3701,n2)+u2;case"cm,in":return ot(.393701*n1,n2)+u2;case"in,cm":return ot(n1/.393701,n2)+u2;case"mm,in":return ot(.0393701*n1,n2)+u2;case"in,mm":return ot(n1/.393701,n2)+u2;case"m,ft":return ot(3.28084*n1,n2)+u2;case"ft,m":return ot(n1/3.28084,n2)+u2;case"cm,ft":return ot(.0328084*n1,n2)+u2;case"ft,cm":return ot(n1/.0328084,n2)+u2;case"mm,ft":return ot(.00328084*n1,n2)+u2;case"ft,mm":return ot(n1/.00328084,n2)+u2;default:return ot(n1,n2)+(u2||u1)}}).replace(RegExp(nur),e=>e.replace(/[()]\s*/g,""));let regex=b?mrg(op[0]):mr(op[0]),nums=cso.match(RegExp(regex));if(!nums)continue;let n1=ton(nums[1].replace(/[()]/g,"")),n2=Number(nums[2].replace(/[()]/g,"")),result=eval(n1+op[1]+n2);cso=cso.replace(RegExp(regex),result)}},opz=["**",["^","**"],"/","*","+","-",["--","- -"]];pm(opz,!0),pm(opz,!1),nsf("@pi",e=>Math.PI),nsf("@e",e=>Math.E),nsf("@mod",(e,t,s)=>t%s),nsf("@sin",(e,t)=>Math.sin(t)),nsf("@asin",(e,t)=>Math.asin(t)),nsf("@cos",(e,t)=>Math.cos(t)),nsf("@acos",(e,t)=>Math.acos(t)),nsf("@tan",(e,t)=>Math.tan(t)),nsf("@atan",(e,t)=>Math.atan(t)),nsf("@abs",(e,t)=>Math.abs(t)),nsf("@floor",(e,t)=>Math.floor(t)),nsf("@ceil",(e,t)=>Math.ceil(t)),nsf("@percent",(e,t)=>100*ton(t)+"%"),nsf("@log",(e,t,s)=>Math.log(s)/(t?Math.log(t):1)),nsf("@root",(e,t,s)=>Math.pow(s,1/t)),nsf("@round",(e,t,s)=>Math.round((ton(t)+Number.EPSILON)*Math.pow(10,s||0))/Math.pow(10,s||0)),nsf("@(?:max|min)",(e,...t)=>{let s=[];for(let e of t.slice(0,-2))e&&s.push(e);return e.includes("@min")?Math.min(...s):Math.max(...s)}),nsf("@clamp",(e,t,s,r)=>(r<s&&([s,r]=[r.trim(),s.trim()]),t<=s?s:t>=r?r:t)),nsf("@degrees",(e,t)=>{let[s,r]=t.replace(/(?=[a-z])/,"|").split("|");return"grad"===r?.9*s:s/Math.PI*180}),nsf("@radians",(e,t)=>{let[s,r]=t.replace(/(?=[a-z])/,"|").split("|");return"grad"===r?s*Math.PI/200:s*Math.PI/180}),nsf("@gradians",(e,t)=>{let[s,r]=t.replace(/(?=[a-z])/,"|").split("|");return"rad"===r?s/Math.PI*200:s/.9}),nsf("@extract",(e,t,s,r)=>t.split(s)[ton(r)-1]||""),nsf("@encode",(e,t)=>encodeURIComponent(t)),nsf("@length",(e,t)=>t.trim().length),nsf("@replace",(e,...t)=>{let s;for(let e=t.length-1;e>0;e--)if(t[e]){s=e;break}let r=(t=t.slice(0,s+1))[0].trim(),n=t.slice(1,-1).join("|").trim()||" ",a=t.slice(-1)[0].trim(),u=n.startsWith("/");if(u){let e=n.trim().match(/\/(.+?)\/([gimusy]*)/).slice(1);n=RegExp(e[0],e[1]||"s")}return r.replace(u?n:RegExp(n.er(),"g"),a)},"notrim"),nsf("@each",(_,a,b,...c)=>{c=c.slice(0,-2).join("|").replace(/\|+$/,"");let ot=[],arr=a.split(b);for(let i in arr){let parsed=c.replace(/\$i/gi,Number(i)+1).replace(/\$v\[([0-9]+)([-+*/][0-9]+)?\]/g,(_,a,b)=>arr[eval(Number(a-1)+(b||0))]).replace(/.?\s*undefined/g,"").replace(/\$v/gi,arr[i]);ot.push(parsed)}return ot.join(" ")}),nsf("@repeat",(e,t,s)=>{let r="";for(let e=0;e<Number(t);e++)r+=s;return r});const tpc=e=>Math.floor(Number(e)/255*100),fpc=e=>Math.ceil(255*Number(e.replace("%",""))/100),thx=e=>Number(e).toString(16).padStart(2,"0"),rfh=(e,t)=>{let s=parseInt(e.replace(/#?(.{0,6})(..)?$/,"$1"),16),r=s>>16&255,n=s>>8&255,a=255&s,u=parseInt(t,16);return u?`rgba(${r}, ${n}, ${a}, ${u})`:`rgb(${r}, ${n}, ${a})`},hx=e=>e.length<3?"0".repeat(8):3===e.length?rfh(e[0]+e[0]+e[1]+e[1]+e[2]+e[2],"00"):4===e.length?rfh(e[0]+e[0]+e[1]+e[1]+e[2]+e[2],e[3]+e[3]):6===e.length?rfh(e.split(/(?=..)/).join(""),"0"):e.padEnd(8,"0");nsf("@colou?r",(e,t,s,r,n,a)=>([s,r,n,a]=[s||"0",r||"0",n||"0",a||""],/#|hash|hex.*|rgba?|hsla?/.test(t)?(s.includes("%")&&(s=fpc(s)),r.includes("%")&&(r=fpc(r)),n.includes("%")&&(n=fpc(n)),a.includes("%")&&(a=fpc(a)),/#|rgba?|hsla?/.test(s)&&(s.includes("#")&&(s=hx(s.replace("#",""))),/rgba?|hsla?/.test(s)&&([s,r,n,a]=s.replace(/^[a-z]{3,4}\((.+)\)/g,"$1").split(","))),/#|hash|hex.*/.test(t)?"#"+thx(s)+thx(r)+thx(n)+(a?thx(a):""):/rgba?/.test(t)?"rgba"===t?`rgba(${s}, ${r}, ${n}, ${a||1})`:`rgb(${s}, ${r}, ${n})`:/hsla?/.test(t)?([r,n]=[tpc(r),tpc(n)],"hsla"===t?`${t}(${s%360}, ${r}%, ${n}%, ${a||1})`:`${t}(${s%360}, ${r}%, ${n}%)`):void 0):`${t.toLowerCase()}(${s} ${r} ${n}${a?" / "+a:""})`)),nsf("@luma",(e,t)=>{t.startsWith("#")&&(t=hx(t.replace("#","").substr(0,6)));let[s,r,n]=t.replace(/^[a-z]{3,4}\((.+)\)/g,"$1").split(",");const a=e=>e<=.03928?e/12.92:(e=>((e+.055)/1.055)**2.4)(e);return.2126*a(s/255)+.7152*a(r/255)+.0722*a(n/255)}),nsf("@colou?rpart",(e,t,s)=>{t=t.trim().toLowerCase();let r=[];const n=(e,t)=>ton("0x"+e.substr(t,2)).toString();if((s=s.trim().toLowerCase()).startsWith("#")){let e=s.replace("#","");3===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+"00"),4===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+e[3].repeat(2)),6===e.length&&(e+="00"),r=[n(e,0),n(e,2),n(e,4),n(e,6)]}else r=s.replace(/^\s*...a?\s*/,"").replace(/[()]/g,"").split(",");return s.startsWith("#")||s.startsWith("rgb")?t.startsWith("r")?r[0]:t.startsWith("g")?r[1]:t.startsWith("b")?r[2]:t.startsWith("a")?r[3]:(nsl("func",["colorpart",t,"of color type rgb/rgba/#"]),s):s.startsWith("hsl")?t.startsWith("h")?r[0]:t.startsWith("s")?r[1]:t.startsWith("l")?r[2]:t.startsWith("a")?r[3]:(nsl("func",["colorpart",t,"of color type hsl/hsla"]),s):(nsl("func",["colorpart",t,"of unknown color type"]),s)});const plg=arg=>{for(let e=0;e<pc3/10;e++)arg=arg.trim().replace(/(?:'(.+?)'|"(.+?)")+/,"$1$2").replace(/\bor\b/gi,"||").replace(/\band\b/gi,"&&").replace(/\bnot\b/gi,"!").replace(/(.+?)\bnor\b(.+)?/gi,"!($1) && !($2)").replace(/(.+?)\bnand\b(.+)?/gi,"!($1) || !($2)").replace(/(.+?)\bxor\b(.+)?/gi,"($1 && !($2)) || (!($1) && $2)").replace(/(.+?)\bxnor\b(.+)?/gi,"$1 == $2").replace(/(?!=)(!?)=(==)?(?!=)/g,"$1$2==");return arg.match(/(<|<=|>|>=|==|!=|&|\||!)/)&&(arg=eval(arg)),["false","undefined","null","NaN",""].includes(arg)&&(arg=!1),arg},lrg=e=>RegExp(r`([+-]?${bnr})\s*(?:${e})\s*([+-]?${bnr})`);nsf("@bitwise",(_,a)=>{a=a.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<");for(let i=0;i<pc3/10;i++)a=a.replace(RegExp(r`(?:~|!|not)\s*([+-]?${bnr})`),(_,a)=>eval("~"+ton(a))).replace(lrg("or|\\|"),(_,a,b)=>eval(`(${ton(a)}) | (${ton(b)})`)).replace(lrg("nor"),(_,a,b)=>eval(`~ (${ton(a)}) | (${ton(b)})`)).replace(lrg("and|&"),(_,a,b)=>eval(`(${ton(a)}) & (${ton(b)})`)).replace(lrg("nand"),(_,a,b)=>eval(`~ (${ton(a)}) & (${ton(b)})`)).replace(lrg("xor"),(_,a,b)=>eval(`(${ton(a)}) ^ (${ton(b)})`)).replace(lrg("xnor"),(_,a,b)=>eval(`~ (${ton(a)}) ^ (${ton(b)})`));return a}),nsf("@boolean",(e,t)=>plg(t)),nsf("@if",(e,t,s,r)=>plg(t)?s:r||"")}cso=cso.replace(/@endvar/g,"");let upc=cso.match(/\$\((.+?)\)/g);if(upc)for(let e of upc){let t=e.replace(/\$\((.*?)(\|.*)?\)/,"$1");cso=cso.replace(e,""),nsl(`Instances of undeclared variable "${t}" have been removed from the ot.`)}cso=cso.replace(/(\s*;)+/g,";").replace(/\s+/g," ").replace(/\.?0{10,}\d*/,"").replace(/(\d)(9{10,})\d?\b/g,(e,t)=>Number(t)+1).replace(/}\s*(?!$)/g,"}\n").replace(/(?<!^\s*)@media/g,"\n$&").replace(/(?<=^\s*@media[^{]*){/gm,"{\n");for(let e in stc)cso=cso.replace(RegExp(r`\/\*STATIC#${e}\*\/`,"g"),stc[e].trim());for(let e in cmc)cso=cso.replace(RegExp(r`\/\*COMMENT#${e}\*\/`,"g"),"/*"+cmc[e]+"*/");if(document.querySelectorAll(`[data-hash="${cso.hash()}"]`).length)break;let se=document.createElement("style");se.innerHTML="\n"+cso.trimStart().trimEnd()+"\n",se.dataset.hash=cso.hash(),se.dataset.source=src[s],(document.head||document.body).appendChild(se)}}String.prototype.hash=function(e){let t=0;for(let e=0;e<this.length;e++)t=(t<<5)-t+this.charCodeAt(e);return Math.abs(t).toString(16).substring(0,e||8).padStart(e,"0")},String.prototype.trim=function(e){return this.replace(/^\s*(.+?)\s*$/,"$1").replace(/\s+/g,e?"":" ")},String.prototype.er=function(){return this.replace(/[.*+?^/${}()|[\]\\]/g,"\\$&")},document.addEventListener("DOMContentLoaded",parseNovaSheets());