function parseNovaSheets(){let e=document.querySelectorAll('link[rel="novasheet"]'),t=[];for(let n of e)t.push(n.href);let n=[];for(let e of t)try{let t=new XMLHttpRequest;t.open("GET",e,!1),t.send();let r=t.responseText;n.push(r.toString())}catch(t){console.error(`NovaSheets parsing failed: File "${e}" cannot be accessed.`)}let r=document.querySelectorAll('template[type="novasheet"]');for(let e of r)n.push(e.innerHTML);for(let e of n){let t=e.split("\n"),n=[],r=[],o={};for(let e in t)if(t[e]=t[e].replace(/[\r\n]/g,"").replace(/^(.*?)\s?\/\/.+$/,"$1"),t[e].match(/\s*---\s*/)&&(t[e]="---"),t[e].match(/^\s*@var\s/)){let r=t[e].replace(/^\s*@var\s/,"");n.push({line:Number(e),contents:r,name:r.split("|")[0].trim(),subvars:r.split("|").splice(1)})}const a=t.indexOf("---"),s=t.slice(a+1).join("\n");window.randomHash=window.randomHash||Math.random().toString().hashCode(6);for(let e in n){let s=n[e].line+1,l=n[e].name.trim(),i=n[e+1]&&n[e+1].line||a;for(o[l]="";s<i&&!t[s].match(/\s*@var\s/);)o[l]+=t[s].trim(),s++;for(let t of n[e].subvars){let a=[randomHash,n[e].name,t.trim()].join("-"),s=`$[${t.trim()}]`,i=`$(${a})`;o[l]=o[l].split(s).join(i),r.push(a)}}let l=0,i=s;const c=50,p=10;for(;i.indexOf("$(")>-1&&l++<c;)for(let e in n){let t=`\\$\\((${n[e].name.escapeRegex()})\\s?${"(?:\\|([^|=)]+?[^|)]+))?".repeat(p)}\\)`,a=i.match(new RegExp(t)),s="\\$\\("+n[e].name+"[^)]*?\\)";if(i=i.replace(new RegExp(s),o[n[e].name]),a)for(let e=0;e<a.length;e++){if(e<2||!a[e])continue;let[t,n]=a[e].split("=");for(let e in r){let o=r[e].trim(),a="\\$\\(\\s*"+o.escapeRegex()+"\\)";o.trim().split("-").splice(2).join("-")===t.trim()&&(i=i.replace(new RegExp(a,"g"),n))}}}if(i=i.replace(/; *;/g,";").replace(/ +/g," "),document.querySelectorAll(`[data-hash="${i.hashCode()}"]`).length)break;let h=document.createElement("style");h.dataset.hash=i.hashCode(),h.innerHTML="\n"+i+"\n",(document.head||document.body).appendChild(h)}}String.prototype.hashCode=function(e=8){let t=0;for(let e=0;e<this.length;e++)t=(t<<5)-t+this.charCodeAt(e);return Math.abs(t).toString(16).substring(0,e).padStart(e,"0")},String.prototype.trim=function(){return this.replace(/^ *(.+?) *$/,"$1")},String.prototype.escapeRegex=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},document.addEventListener("DOMContentLoaded",function(){parseNovaSheets()});