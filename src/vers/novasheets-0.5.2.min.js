function e(e,t=8){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t);return Math.abs(r).toString(16).substring(0,t).padStart(t,"0")}function t(e,r){return"func"==e?t(`Unknown argument "${r[1]}" in function "${r[0]}" ${r[2]}`.trim()+"."):console.warn("<NovaSheets>",e)}function parseNovaSheets(r){const a=String.raw;let l=[],s=[],n,i;if(r)l=[r.toString()],s="raw";else{try{n=document.querySelectorAll('link[rel="novasheet" i], link[rel="novasheets" i]'),i=document.querySelectorAll('[type="novasheet" i], [type="novasheets" i]')}catch(c){n=document.querySelectorAll('link[rel="novasheet"], link[rel="novasheets"]'),i=document.querySelectorAll('[type="novasheet"], [type="novasheets"]')}let e={full:[],rel:[]};for(let t of n)e.full.push(t.href),e.rel.push(t.getAttribute("href"));for(let r in e.full)try{let a=new XMLHttpRequest;if(a.open("GET",e.full[r],!1),a.send(),404==a.status)throw 404;let n=a.responseText;l.push(n.toString()),s.push(e.rel[r])}catch(o){t(`File "${e.rel[r]}" cannot be accessed.`)}for(let e of i)l.push(e.innerHTML),s.push("inline")}window.randomHash=window.randomHash||e(Math.random().toString(),6);for(let n in l){l[n]=l[n].replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/(?<![a-z]+:)\n?\/\/.*$/gm,"").replace(/(?:@var.+?=.*$|@var\s*[^=]*(?=\n\s*@var\s.))(?!\n\s*@endvar)/gm,"$& @endvar").replace(/@(var|const|endvar)/g,"\n$&").replace(/@const\s*[A-Z_]+\s*(true|false|[0-9]+)|@endvar/g,"$&\n");let i=l[n].split("\n"),c="",o=[],p=[];for(let e in i)i[e]=i[e].replace(/[\r\n]/g," "),c+="\n"+i[e];c=c.replace(/\s*(?:@var.*?((?=@var)|@endvar)|@const\s*[A-Z_]+\s*(true|false|[0-9]+))/gms," ").replace(/\/\*(.+?)\*\//gs,(e,t)=>e.startsWith("/*[")&&e.endsWith("]*/")?e.replace(/^\/\*\[(.+)\]\*\/$/,"/*$1*/"):e.startsWith("/*/")||e.endsWith("/*/")?e:(o.indexOf(t)<0&&o.push(t),"/*COMMENT#"+o.indexOf(t)+"*/")).replace(/\/\*\/(.+?)\/\*\//gs,(e,t)=>(p.indexOf(t)<0&&p.push(t),"/*STATIC#"+p.indexOf(t)+"*/"));let h=[],$=50,u=5,g=10,m=!1;for(let e in i)if(i[e].match(/^\s*@var\s/)){let t=i[e].replace(/^\s*@var\s/,"").split("="),r=i.slice(e),a;for(let e in r)if(r[e].match(/^\s*@endvar\s*$|^\s*@var\s/)&&0!=e){a=e;break}let l=t[0].trim(),s=(t.slice(1).join("=")||"")+r.slice(1,a).join(" ");h.push({name:l.split("|")[0].trim(),content:s.trim()})}else i[e].match(/^\s*@const\s*MAX_RECURSION\s/)?$=parseInt(i[e].split("MAX_RECURSION")[1]):i[e].match(/^\s*@const\s*MAX_MATH_RECURSION\s/)?u=parseInt(i[e].split("MAX_MATH_RECURSION")[1]):i[e].match(/^\s*@const\s*MAX_ARGUMENTS\s/)?g=parseInt(i[e].split("MAX_ARGUMENTS")[1]):i[e].match(/^\s*@const\s*KEEP_NAN\s/)&&(m=!["0","false"].includes(i[e].split("KEEP_NAN")[1].trim()));const d=e=>m?Number(e):isNaN(Number(e))?"":Number(e),f=a`(?:[0-9]*\.?[0-9]+)`,b=a`(?:0x[0-9a-f]*\.?[0-9a-f]+|0b[01]*\.?[01]+|0o[0-7]*\.?[0-7]+|${f})`,M=a`(?:\(\s*${b}\s*\)|${b})`,v=a`(?:\(\s*${b}\s*\)|${b})\s*[a-z]*[-+*^/e\s]+(?:\(\s*${b}\s*\)|${b})\s*[a-z]*`,N=a`\s*(?:em|rem|en|ex|px|pt|pc|cm|mm|m\b|ft|in)`,x=e=>a`(?:[-e^*/+\s${e?"()":""}]+(?=\d|\.))`,E=e=>{const t=a`\(\s*`,r=a`\s*\)`,l=`${b}${N}?`;let s=a`(?:(?:${`(?:${t}${l}${r}|${l})`}\s*${e.op||x(e.b)}\s*)+(?:${l}))`;return a`\(${s}\)|${s}`},R=()=>{for(let e=0;e<u&&c.match(RegExp(v));e++)c=c.replace(RegExp(E({}),"g"),e=>{let t=!e.match(/[-+e^*/]/),r=e.match(RegExp(a`${N}\s-?${b}`));if(t||r)return e;let l=e.match(RegExp(N,"g"))||[];l=l[0]||"";let s=e.replace(RegExp(N,"g"),"").replace(/\d\s*e\s*\d/g,"$&".replace(/\s/g,"")).replace(/--/g,"- -").replace(/\^/g,"**");try{return eval(s)+l}catch(n){return s+l}})},S=e=>e.replace(/[.*+?^/${}()|[\]\\]/g,"\\$&"),A=(e,t)=>{let r=!e||e===1/0||Number.isNaN(e);return r&&m?"NaN":r&&!m?t||0:e},y=(e,t,r={})=>{R();let l=RegExp(a`\$\(\s*${e}\b`),s=c.match(l);if(!s)return;let n,i=s?c.indexOf(s[0]):-1,o=c.substr(i),p="",h=0;for(let e=0;e<o.length&&(p+=o[e],h>0&&(n=!0),"("===o[e]&&h++,")"===o[e]&&h--,!n||0!==h);e++)if(e==o.length-1&&h>0)return;if(!p.trim("force"))return;let $=r.notrim?"|":/\s*\|\s*/,u=p.replace(/^\$\(\s*|\s*\)$/g,"").split($);for(let e=0;e<g;e++)u[e]||(u[e]="");u[0]=p,u=u.slice(0,u.indexOf("")),c=c.replace(p,t(...u))};let I=0,W;for(;(c.indexOf("$(")>-1||I<1)&&I++<$&&W!==c;){W=c;for(let e in h)y(h[e].name,(t,...r)=>{let l=h[e].content;for(let e in r){if(!r[e])continue;let t=r[e].split("="),s=t[1]?t[0].trim():+e+1,n=t[1]?t[1].trim():t[0].trim();l=l.replace(RegExp(a`\$\[${s}[^\]]*\]`,"g"),n)}return l=l.replace(/\$\[.*?(?:\|([^\]]*))?\]/g,"$1")});y("@each",(e,t,r,a,...l)=>{let s=[],n=t.trim().split(r.trim());for(let e in n){let t=l.join("|").replace(/\$i/gi,Number(e)+1).replace(/\$v\[([0-9]+)([-+*/][0-9]+)?\]/g,(e,t,r)=>n[eval(Number(t-1)+(r||0))]).replace(/.?\s*undefined/g,"").replace(/\$v/gi,n[e]);s.push(t)}return s.join(a)},{notrim:!0}),y("@repeat",(e,t,...r)=>{let a="";for(let e=0;e<Number(t);e++)a+=r.join("|").replace(/\$i/gi,Number(e)+1);return a},{notrim:!0}),y("@e",e=>Math.E),y("@pi",e=>Math.PI),y("@mod",(e,t,...r)=>A(t%r,e)),y("@sin",(e,t)=>A(Math.sin(t),e)),y("@asin",(e,t)=>A(Math.asin(t),e)),y("@cos",(e,t)=>A(Math.cos(t),e)),y("@acos",(e,t)=>A(Math.acos(t),e)),y("@tan",(e,t)=>A(Math.tan(t),e)),y("@atan",(e,t)=>A(Math.atan(t),e)),y("@abs",(e,t)=>A(Math.abs(t),e)),y("@floor",(e,t)=>A(Math.floor(t),e)),y("@ceil",(e,t)=>A(Math.ceil(t),e)),y("@percent",(e,t)=>A(100*d(t)+"%",e)),y("@log",(e,t,r)=>A(Math.log(r)/(t?Math.log(t):1),e)),y("@root",(e,t,r)=>A(Math.pow(r||t,1/(r?t:2)),e)),y("@round",(e,t,r)=>{let a=d(t)+Number.EPSILON,l=Math.pow(10,r||0);return A(Math.round(a*l)/l,e)}),y("@(?:max|min)",(e,...t)=>{let r=[];for(let e of t)e&&r.push(e);let a=e.includes("@min")?Math.min(...r):Math.max(...r);return A(a,e)}),y("@clamp",(e,t,r,a)=>{let l=Number(t),s=Number(r),n=Number(a);return n<s&&([s,n]=[n,s]),A(l<=s?s:l>=n?n:l,e)}),y("@degrees",(e,t)=>{let[r,a]=[t.replace(/[a-z]+/,""),t.replace(RegExp(f),"")];if("grad"===a)return.9*r;let l=r/Math.PI*180;return A(l,e)}),y("@radians",(e,t)=>{let[r,a]=[t.replace(/[a-z]+/,""),t.replace(RegExp(f),"")];if("grad"===a)return r*Math.PI/200;let l=r*Math.PI/180;return A(l,e)}),y("@gradians",(e,t)=>{let[r,a]=[t.replace(/[a-z]+/,""),t.replace(RegExp(f),"")];return"rad"===a?r/Math.PI*200:A(r/.9,e)}),y("@extract",(e,t,r,a)=>t.split(r)[d(a)-1]||""),y("@encode",(e,t)=>encodeURIComponent(t)),y("@length",(e,t)=>t.trim().length),y("@replace",(e,...t)=>{let r=t[0].trim(),a=t.slice(1,-1).join("|").trim()||" ",l=t.slice(-1)[0].trim(),s=a.startsWith("/");if(s){let e=a.trim().match(/\/(.+?)\/([gimusy]*)/).slice(1);a=RegExp(e[0],e[1]||"s")}return r.replace(s?a:RegExp(S(a),"g"),l)},{notrim:!0});const e=e=>Math.floor(Number(e)/255*100),r=e=>Math.ceil(255*Number(e.replace("%",""))/100),l=e=>Number(e).toString(16).padStart(2,"0"),s=(e,t)=>{let r=parseInt(e.replace(/#?(.{0,6})(..)?$/,"$1"),16),a=r>>16&255,l=r>>8&255,s=255&r,n=parseInt(t,16);return n?`rgba(${a}, ${l}, ${s}, ${n})`:`rgb(${a}, ${l}, ${s})`},n=e=>e.length<3?"0".repeat(8):3===e.length?s(e[0]+e[0]+e[1]+e[1]+e[2]+e[2],"00"):4===e.length?s(e[0]+e[0]+e[1]+e[1]+e[2]+e[2],e[3]+e[3]):6===e.length?s(e.split(/(?=..)/).join(""),"0"):e.padEnd(8,"0");y("@colou?r",(t,a,s,i,c,o)=>([s,i,c,o]=[s||"0",i||"0",c||"0",o||""],/#|hash|hex.*|rgba?|hsla?/.test(a)?(s.includes("%")&&(s=r(s)),i.includes("%")&&(i=r(i)),c.includes("%")&&(c=r(c)),o.includes("%")&&(o=r(o)),/#|rgba?|hsla?/.test(s)&&(s.includes("#")&&(s=n(s.replace("#",""))),/rgba?|hsla?/.test(s)&&([s,i,c,o]=s.replace(/^[a-z]{3,4}\((.+)\)/g,"$1").split(","))),/#|hash|hex.*/.test(a)?"#"+l(s)+l(i)+l(c)+(o?l(o):""):/rgba?/.test(a)?"rgba"===a?`rgba(${s}, ${i}, ${c}, ${o||1})`:`rgb(${s}, ${i}, ${c})`:/hsla?/.test(a)?([i,c]=[e(i),e(c)],"hsla"===a?`${a}(${s%360}, ${i}%, ${c}%, ${o||1})`:`${a}(${s%360}, ${i}%, ${c}%)`):void 0):`${a.toLowerCase()}(${s} ${i} ${c}${o?" / "+o:""})`)),y("@luma",(e,t)=>{let r,a,l,s=t.startsWith("#")?n(t.replace("#","").substr(0,6)):t;[r,a,l]=s.replace(/^[a-z]{3,4}\((.+)\)/g,"$1").split(",");const i=e=>e<=.03928?e/12.92:(e=>((e+.055)/1.055)**2.4)(e);return.2126*i(r/255)+.7152*i(a/255)+.0722*i(l/255)}),y("@colou?rpart",(e,r,a)=>{let l=r.trim().toLowerCase(),s=a.trim().toLowerCase(),n=[];const i=(e,t)=>d("0x"+e.substr(t,2)).toString();if(s.startsWith("#")){let e=s.replace("#","");3===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+"00"),4===e.length&&(e=e[0].repeat(2)+e[1].repeat(2)+e[2].repeat(2)+e[3].repeat(2)),6===e.length&&(e+="00"),n=[i(e,0),i(e,2),i(e,4),i(e,6)]}else n=s.replace(/^\s*...a?\s*/,"").replace(/[()]/g,"").split(",");return s.startsWith("#")||s.startsWith("rgb")?l.startsWith("r")?n[0]:l.startsWith("g")?n[1]:l.startsWith("b")?n[2]:l.startsWith("a")?n[3]:(t("func",["colorpart",l,"of color type rgb/rgba/#"]),s):s.startsWith("hsl")?l.startsWith("h")?n[0]:l.startsWith("s")?n[1]:l.startsWith("l")?n[2]:l.startsWith("a")?n[3]:(t("func",["colorpart",l,"of color type hsl/hsla"]),s):(t("func",["colorpart",l,"of unknown color type"]),s)});const i=e=>{for(let t=0;t<g/10;t++)e=e.trim().replace(/(?:'(.+?)'|"(.+?)")+/,"$1$2").replace(/\bor\b/gi,"||").replace(/\band\b/gi,"&&").replace(/\bnot\b/gi,"!").replace(/(.+?)\bnor\b(.+)?/gi,"!($1) && !($2)").replace(/(.+?)\bnand\b(.+)?/gi,"!($1) || !($2)").replace(/(.+?)\bxor\b(.+)?/gi,"($1 && !($2)) || (!($1) && $2)").replace(/(.+?)\bxnor\b(.+)?/gi,"$1 == $2").replace(/(?!=)(!?)=(==)?(?!=)/g,"$1$2==");return e.match(/(<|<=|>|>=|==|!=|&|\||!)/)&&(e=eval(e)),["false","undefined","null","NaN",""].includes(e)&&(e=!1),e},o=e=>RegExp(a`([+-]?${M})\s*(?:${e})\s*([+-]?${M})`);y("@bitwise",(e,t)=>{let r=t.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<");for(let e=0;e<g/10;e++)r=r.replace(RegExp(a`(?:~|!|not)\s*([+-]?${M})`),(e,t)=>eval("~"+d(t))).replace(o("or|\\|"),(e,t,r)=>eval(`(${d(t)}) | (${d(r)})`)).replace(o("nor"),(e,t,r)=>eval(`~ (${d(t)}) | (${d(r)})`)).replace(o("and|&"),(e,t,r)=>eval(`(${d(t)}) & (${d(r)})`)).replace(o("nand"),(e,t,r)=>eval(`~ (${d(t)}) & (${d(r)})`)).replace(o("xor"),(e,t,r)=>eval(`(${d(t)}) ^ (${d(r)})`)).replace(o("xnor"),(e,t,r)=>eval(`~ (${d(t)}) ^ (${d(r)})`));return r}),y("@boolean",(e,t)=>i(t)),y("@if",(e,t,r,a)=>i(t)?r:a||"")}c=c.replace(/@endvar/g,"");let w=c.match(/\$[\[(](.+?)[\])]/g);if(w)for(let e of w){let r=e.replace(/\$[\[(](.*?)(\|.*)?[\])]/,"$1").trim();c=c.replace(e,"");let a=e.includes("$(")?"variable":"argument";t(`Instances of unparsed ${a} "${r}" have been removed from the output.`)}c=c.replace(/(\s*;)+/g,";").replace(/(?<!^ *) +/gm," ").replace(/\.0{10,}\d/g,"").replace(/(\.(\d)\2{9,})\d/g,"$1").replace(/(\d+)\.9{10,}\d?(?=\D)/g,(e,t)=>Number(t)+1);for(let e in p)c=c.replace(RegExp(a`\/\*STATIC#${e}\*\/`,"g"),p[e].trim());for(let e in o)c=c.replace(RegExp(a`\/\*COMMENT#${e}\*\/`,"g"),"/*"+o[e]+"*/");if(r)return t("Output: "+c.trim()),c.trim();{if(document.querySelectorAll(`[data-hash="${e(c)}"]`).length)break;let t=document.createElement("style");t.innerHTML="\n"+c.trimStart().trimEnd()+"\n",t.dataset.hash=e(c),t.dataset.source=s[n],(document.head||document.body).appendChild(t)}}}String.prototype.trim=function(e){return this.replace(/^\s*(.+?)\s*$/,"$1").replace(/\s+/g,e?"":" ")},document.addEventListener("DOMContentLoaded",parseNovaSheets());