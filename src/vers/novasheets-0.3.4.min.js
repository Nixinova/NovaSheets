function nse(e){console.error("<NovaSheets> Parsing failed: "+e)}function pns(){let sh,inl;try{sh=document.querySelectorAll('link[rel="novasheet" i], link[rel="novash" i]'),inl=document.querySelectorAll('[type="novasheet" i], [type="novash" i]')}catch(e){sh=document.querySelectorAll('link[rel="novasheet"], link[rel="novash"]'),inl=document.querySelectorAll('[type="novasheet"], [type="novash"]')}let fn={full:[],rel:[]},sources=[];for(let e of sh)fn.full.push(e.href),fn.rel.push(e.getAttribute("href"));let sc=[];for(let e in fn.full)try{let s=new XMLHttpRequest;s.open("GET",fn.full[e],!1),s.send();let t=s.responseText;sc.push(t.toString()),sources.push(fn.rel[e])}catch(s){nse(`File "${fn.rel[e]}" cannot be accessed.`)}for(let e of inl)sc.push(e.innerHTML),sources.push("inl");for(let s in sc){let ln=sc[s].split("\n"),cv=[],lv=[],st={},MAX_RECURSION=50,MAX_ARGUMENTS=10;for(let e in ln)if(ln[e]=ln[e].replace(/[\r\n]/g,"").replace(/^(.*?)\s?\/\/.+$/,"$1"),ln[e].match(/\s*---\s*/))ln[e]="---";else if(ln[e].match(/^\s*@var\s/)){let s=ln[e].replace(/^\s*@var\s/,"");cv.push({line:Number(e),contents:s,name:s.split("|")[0].trim(),sv:s.split("|").splice(1)})}else ln[e].match(/^\s*@const\s*MAX_RECURSION\s/)?MAX_RECURSION=Number(ln[e].split("MAX_RECURSION")[1]):ln[e].match(/^\s*@const\s*MAX_ARGUMENTS\s/)&&(MAX_ARGUMENTS=Number(ln[e].split("MAX_ARGUMENTS")[1]));window.randomHash=window.randomHash||Math.random().toString().hsh(6);const vde=ln.indexOf("---"),csc=ln.slice(vde+1).join("\n");let cso=csc,loop=0;for(let e in cv){let s=cv[e].line+1,t=cv[e].name.trim(),n=cv[e+1]&&cv[e+1].line||vde;for(st[t]="";s<n&&!ln[s].match(/\s*@var\s/);)st[t]+=ln[s].replace(/^\s*@const.+/,"").trim(),s++;for(let s of cv[e].sv){let n=[e,cv[e].name,randomHash,s.trim()].join("~"),r=`$[${s.trim()}]`,l=`$(${n})`;st[t]=st[t].split(r).join(l),lv.push(n)}}for(;(cso.indexOf("$(")>-1||loop<2)&&loop++<MAX_RECURSION;){for(let e in cv){let s=cv[e].name.escapeRegex(),t="(?:\\s*\\|([^|=$()]+?[^|$()]+))?".repeat(MAX_ARGUMENTS),n=`\\$\\(\\s*(${s})\\s*${t}\\)`,r=cso.match(RegExp(n));if(!r)continue;let l="\\$\\(\\s*"+s+"[^$()]*?\\)";cso=cso.replace(RegExp(l),st[cv[e].name]);for(let e=0;e<r.length;e++){if(e<2||!r[e])continue;let[s,t]=r[e].split("=");for(let e in lv){let n=lv[e].trim(),r="\\$\\(\\s*"+n.escapeRegex()+"\\)",l=n.trim().split("~").splice(3).join("~");l===s.trim()&&(cso=cso.replace(RegExp(r,"g"),t))}}}const nm="[0-9]*(?:\\.[0-9]*)?",nsf=(e,s,t)=>(Array.isArray(s)||(s=Array(t||MAX_ARGUMENTS).fill(s||"[^|)]*?")),RegExp(`\\$\\(\\s*${e}\\s*(?:\\|(\\s*${s.join("))?\\s*(?:\\|(\\s*")}))?\\s*\\)`,"g")),ga=(e,s)=>{let t=e.replace(/\$\((.*)\)/,"$1").split("|");return s?t[s]&&t[s].trim():t.join("|").replace(/\s*\|\s*/g,"|").split("|").splice(1)};cso=cso.replace(nsf("@if"),args=>{let a=ga(args,1),b=ga(args,2),c=ga(args,3),test=a.replace(/(?:'(.+?)'|"(.+?)")+/,"$1$2").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/(?!=)(!?)=(==)?(?!=)/g,"$1$2==");return test.match(/(<|<=|>|>=|==|!=)/)&&(test=eval(test)),test=!["false","undefined","null","NaN",""].includes(test),test?b:c});const nmr="(?:0x|0b|0o)?(?:[0-9]*[.])?[0-9]+",lur="(cm|mm|ft|in)",mr=e=>"("+nmr+")\\s*"+e.escapeRegex()+"\\s*("+nmr+")",mrb=e=>"\\(\\s*"+mr(e)+"\\s*\\)",pm=(ops,b)=>{for(let op of ops){Array.isArray(op)||(op=[op,op]);let regex=b?mrb(op[0]):mr(op[0]),nums=cso.match(RegExp(regex));if(!nums)continue;let result=eval(`Number(${nums[1]}) ${op[1]} Number(${nums[2]})`);nums&&(cso=cso.replace(RegExp(regex),result))}};for(let e=0;e<5;e++)cso=cso.replace(/(?:\+|--)+([.0-9]+)/,"+$1").replace(/(?:\+-|-\+)+(?:\++)?([.0-9]+)/,"-$1").replace(RegExp("("+nmr+")deg","g"),e=>Number(e.replace("deg",""))*Math.PI/180).replace(RegExp("("+nmr+")grad","g"),e=>Number(e.replace("grad",""))*Math.PI/200).replace(RegExp(nmr+lur),e=>{switch((e=e.split(RegExp(lur)).splice(0,2))[1]){case"cm":return e[0]/100+"m";case"mm":return e[0]/1e3+"m";case"ft":return.3048*e[0]+"m";case"in":return.0254*e[0]+"m"}}).replace(RegExp(nmr+"m\\s*(\\*\\*|^|/|\\*|\\+|-)\\s*"+nmr+"(?=m[^m])"),e=>e.replace(/m/g,"")),pm(["**",["^","**"],"/","*","+","-",["--","- -"]],!0),pm(["**",["^","**"],"/","*","+","-",["--","- -"]],!1);cso=cso.replace(nsf("@mod",nm,2),e=>ga(e,1)%ga(e,2)).replace(nsf("@min",nm),e=>Math.min(...ga(e))).replace(nsf("@max",nm),e=>Math.max(...ga(e))).replace(nsf("@clamp",nm,3),e=>{let s=ga(e,1),t=ga(e,2),n=ga(e,3);return n<t&&([t,n]=[n,t]),s<=t?t:s>=n?n:s}).replace(nsf("@sin",nm,1),e=>Math.sin(ga(e,1))).replace(nsf("@asin",nm,1),e=>Math.asin(ga(e,1))).replace(nsf("@cos",nm,1),e=>Math.cos(ga(e,1))).replace(nsf("@acos",nm,1),e=>Math.acos(ga(e,1))).replace(nsf("@tan",nm,1),e=>Math.tan(ga(e,1))).replace(nsf("@atan",nm,1),e=>Math.atan(ga(e,1))).replace(nsf("@abs",nm,1),e=>Math.abs(ga(e,1))).replace(nsf("@floor",nm,1),e=>Math.floor(ga(e,1))).replace(nsf("@ceil",nm,1),e=>Math.ciel(ga(e,1))).replace(nsf("@percent",nm,1),e=>100*Number(ga(e,1))+"%").replace(nsf("@round",nm,2),e=>{let s=Number(ga(e,1))+Number.EPSILON,t=ga(e,2)||0;return Math.round(s*10**t)/10**t}).replace(nsf("@log",nm,1),e=>Math.log(ga(e,1))).replace(nsf("@root",nm,2),e=>Math.pow(ga(e,2),1/ga(e,1))).replace(/\$\(@pi\)/g,Math.PI).replace(/\$\(@e\)/g,Math.E),cso=cso.replace(nsf("@encode"),e=>encodeURIComponent(ga(e,1))).replace(nsf("@replace"),e=>ga(e,1).replace(ga(e,2),ga(e,3))).replace(nsf("@length"),e=>ga(e,1).length),cso=cso.replace(nsf("@color"),e=>{let s=ga(e,1),t=ga(e,2)||0,n=ga(e,3)||0,r=ga(e,4)||0,l=ga(e,5)||0;return"hash"===s|"#"===s?t?((t=Math.abs(Math.round(t.replace("#",""))).toString()).length<3&&(t=t.padStart(3,0)),5===t.length&&(t=t.padStart(6,0)),7===t.length&&(t=t.padStart(8,0)),"#"+t):"#000":["rgb","hsl"].includes(s)?`${s}(${t}, ${n}, ${r})`:["rgba","hsla"].includes(s)?`${s}(${t}, ${n}, ${r}, ${l})`:void 0}).replace(nsf("@colorpart"),e=>{let s=ga(e,1),t=ga(e,2)||0,n=[];const r=(e,s)=>Number("0x"+e.substr(s,2)).toString();if(t.startsWith("#")){let e=t.replace("#","");3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+"00"),4===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),6===e.length&&(e=e.repeat(2)+"00"),n=[r(e,0),r(e,2),r(e,4),r(e,6)]}else n=t.replace(/^\s*...a?/,"").split(",");return t.startsWith("#")||t.startsWith("rgb")?["red","r"].includes(s)?n[0]:["green","g"].includes(s)?n[1]:["blue","b"].includes(s)?n[2]:["alpha","a"].includes(s)?n[3]:(nse(`Unknown part identifier "${s}" in function "@colorpart" of color type "rgb"/"rgba"/"#".`),t):t.startsWith("hsl")?["hue","h"].includes(s)?n[0]:["saturation","s"].includes(s)?n[1]:["lightness","l"].includes(s)?n[2]:["alpha","a"].includes(s)?n[3]:(nse(`Unknown part identifier "${s}" in function "@colorpart" of color type "hsl"/"hsla".`),t):(nse(`Unknown part identifier "${s}" in function "@colorpart" of unknown color type.`),t)})}if(cso=cso.replace(/;\s*;/g,";").replace(/\s+/g," "),document.querySelectorAll(`[data-hash="${cso.hsh()}"]`).length)break;let styleElem=document.createElement("style");styleElem.dataset.hash=cso.hsh(),styleElem.dataset.source=sources[s],styleElem.innerHTML="\n"+cso+"\n",(document.head||document.body).appendChild(styleElem)}}String.prototype.hsh=function(e){let s=0;for(let e=0;e<this.length;e++)s=(s<<5)-s+this.charCodeAt(e);return Math.abs(s).toString(16).substring(0,e||8).padStart(e,"0")},String.prototype.escapeRegex=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},document.addEventListener("DOMContentLoaded",function(){try{pns()}catch(e){console.error(e)}});